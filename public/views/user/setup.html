<html>
    <head>
        <title>Express</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/toast.css" />
        <link rel="stylesheet" href="/css/bootstrap.min.css" />
        <script src="/dist/bundle.js"></script>
        <link rel="stylesheet" href="/css/bootstrap-icons.css" />
    </head>

    <body>
        <div id="app">
            <loading-component v-show="isLoading"></loading-component>
            <navbar-component></navbar-component>
            <div class="content">
                <section class="section">
                    <div class="container">
                        <div class="d-flex flex-column justify-content-center align-items-center">
                            <div class="card text-center p-3">
                                <section v-if="step==1" class="support section-bg">
                                    <div class="container">
                                        <div class="section-title">
                                            <h2>Hi there</h2>
                                            <p>Start by choosing your preferred cloud drive to connect!</p>
                                        </div>
                                        <div class="row align-items-center justify-content-center" data-aos="zoom-in">
                                            <div
                                                @click="nextStep('gdrive')"
                                                class="
                                                    btn
                                                    col-lg-2 col-md-4 col-6
                                                    align-items-center
                                                    justify-content-center
                                                "
                                            >
                                                <img
                                                    src="/img/support_1.png"
                                                    class="img-fluid"
                                                    alt=""
                                                    @load="onImgLoad(0)"
                                                />
                                                <p>Google Drive</p>
                                            </div>

                                            <div
                                                class="
                                                    btn
                                                    col-lg-2 col-md-4 col-6
                                                    align-items-center
                                                    justify-content-center
                                                "
                                            >
                                                <img
                                                    src="/img/support_2.png"
                                                    class="img-fluid"
                                                    alt=""
                                                    @load="onImgLoad(1)"
                                                />
                                                <p>Coming Soon</p>
                                            </div>

                                            <div
                                                class="
                                                    btn
                                                    col-lg-2 col-md-4 col-6
                                                    align-items-center
                                                    justify-content-center
                                                "
                                            >
                                                <img
                                                    src="/img/support_3.png"
                                                    class="img-fluid"
                                                    alt=""
                                                    @load="onImgLoad(2)"
                                                />
                                                <p>Coming Soon</p>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                                <section v-if="step==2" class="support section-bg">
                                    <div class="container p-0">
                                        <div class="section-title">
                                            <h2>{{title}}</h2>
                                            <div class="text-start">
                                                <h3>Step 1</h3>
                                                <p
                                                    >Create a folder in your
                                                    <a
                                                        href="https://drive.google.com/drive/my-drive"
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                        >Google Drive</a
                                                    >.</p
                                                >
                                                <br />
                                                <h3>Step 2</h3>
                                                <p>Share your new created folder with:</p>
                                                <mark ref="emailToShare">{{emailToShare}}</mark>
                                                <button class="btn btn-outline-primary mx-2" @click="copyEmail()"
                                                    >Copy</button
                                                >
                                                <p>Do share with editor privelage</p>
                                                <br />
                                                <h3>Step 3</h3>
                                                <span>If setup has been done correctly click Verify</span>
                                                <button class="btn btn-primary mx-2" @click="verify()">Verify</button>
                                                <p v-show="!isReady" class="text-danger">{{errorMsg}}</p>
                                                <p v-show="isReady" class="text-success"
                                                    >You have connected your drive successfully</p
                                                >
                                            </div>
                                            <br />
                                            <button
                                                :disabled="!isReady"
                                                @click="addDrive()"
                                                class="btn btn-success btn-lg btn-block"
                                                >Complete</button
                                            >
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <footer-component></footer-component>
        </div>
    </body>
    <script>
        const app = Vue.createApp({
            el: '#app',
            data() {
                return {
                    isLoading: false,
                    isFileLoading: [true, true, true],
                    step: 1,
                    drive: '',
                    title: '',
                    emailToShare: 'drive-597@wad-1-288a9.iam.gserviceaccount.com',
                    isReady: false,
                    errorMsg: '',
                };
            },
            mounted() {},
            methods: {
                onImgLoad(index) {
                    this.isFileLoading[index] = false;
                    let checker = (arr) => arr.every((v) => v === false);
                    if (checker(this.isFileLoading)) {
                        this.isLoading = false;
                    }
                },
                nextStep(chosenDrive) {
                    this.step = 2;
                    this.drive = chosenDrive;
                    if (chosenDrive === 'gdrive') {
                        this.title = 'Google Drive';
                    }
                },
                async copyEmail() {
                    await navigator.clipboard.writeText(this.emailToShare);
                    toast('Email has been copied', {
                        position: 'top-right',
                        type: 'info',
                        showIcon: 'true',
                    });
                },
                verify() {
                    this.isLoading = true;
                    axios
                        .get('../userApi/CheckGoogleFile')
                        .then(({ data }) => {
                            this.isReady = data.status;
                            if (!data.status) {
                                this.errorMsg = data.msg;
                            }
                            this.isLoading = false;
                        })
                        .catch((error) => {
                            this.isReady = false;
                            this.errorMsg = error.response.data.msg;
                            this.isLoading = false;
                        });
                },
                addDrive() {
                    this.isLoading = true;
                    axios
                        .post('../userApi/SetGoogleFile')
                        .then(({ data }) => {
                            this.isLoading = false;
                            window.location.href = '/user/dashboard';
                        })
                        .catch((error) => {
                            this.isLoading = false;
                        });
                },
            },
        });
        app.component('navbar-component', navbar);
        app.component('loading-component', loadingPage);
        app.component('footer-component', footer);
        app.mount('#app');
    </script>
</html>
